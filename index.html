<!doctype html>
<html>
  <head>
    <style>
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: 'sans-serif';
      }

      #canvas {
        display: block;
        border-radius: 8px;
        background: #fff;
        max-width: 1080px;
        width: 80%;
        height: auto;
        box-shadow: 0 2px 8px rgba(0, 0, 0, .25);
        margin: 40px auto;
        outline: none;
      }
    </style>

    <meta charset="utf-8"/>
    <title>XR 360 Viewer</title>
  </head>

  <body>
    <div class="container">
      <canvas id="canvas" width="1080" height="600" tabIndex="1"></canvas>
    </div>

    <script async src="https://lovr.org/static/f/v0.14.0/lovr.js"></script>

    <script type="text/javascript">
      var timer;
      var canvas = document.getElementById('canvas');

      var Module = window.Module = {
        arguments: [],
        preRun: [],
        postRun: [],
        print: console.log.bind(console),
        printErr: console.error.bind(console),
        thisProgram: './lovr',
        canvas: canvas
      };
      // To run a LÖVR project on this page, create a .lovr (zip) file of its folder and serve it
      // alongside the HTML file.  Then set the 'project' variable below to the project's filename.
      // This downloads the .lovr file into the virtual filesystem and adds it as a virtual command
      // line argument before booting up LÖVR.
      // Example: var project = 'app.lovr';
      // var project = 'viewer.lovr';
      var project = 'viewer.lovr';
      if (project) {
        Module.arguments.push(project);
        Module.preRun.push(function() {
          Module.FS_createPreloadedFile('/', project, project, true, false);
        });
      }

      var setupWebXR = function() {
        if (!Module.lovr) return;
        // If WebXR is supported and immersive sessions are supported, add a button to the DOM that
        // controls starting/stopping the immersive session.
        if (navigator.xr) {
          navigator.xr.isSessionSupported('immersive-vr').then(function(supported) {
            if (!supported) return;

            navigator.xr.addEventListener('sessiongranted', e => {
              Module.lovr.enterVR().then(function(session) {
                session.addEventListener('end', () => {});
              });
            });

            // Module.lovr.exitVR().then(onExit);
          });
        }
        clearInterval(timer);
      };

      timer = setInterval(setupWebXR, 100);
    </script>
  </body>
</html>